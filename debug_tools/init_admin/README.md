# 管理員帳戶初始化工具

這是一個獨立的管理員帳戶初始化工具，可以連接到任何指定的 MongoDB 資料庫來建立管理員使用者。

## 特點

- **完全獨立**: 不依賴於核心系統配置
- **靈活配置**: 支持任意 MongoDB 連接參數
- **互動式介面**: 友善的命令行互動介面
- **預設配置**: 內建常用的配置選項
- **安全輸入**: 密碼輸入時隱藏顯示

## 系統需求

- Python 3.7+
- pymongo
- flask-bcrypt

## 安裝依賴

```bash
pip install pymongo flask-bcrypt
```

## 使用方法

1. 進入工具目錄：
```bash
cd debug_tools/init_admin
```

2. 執行工具：
```bash
python init_admin.py
```

3. 按照提示選擇資料庫配置：
   - **本地開發環境**: 無認證的本地 MongoDB (localhost:27017)
   - **本地核心服務**: 系統預設的核心服務 MongoDB (localhost:55101)
   - **自訂設定**: 手動輸入所有連接參數

4. 輸入管理員帳戶資訊：
   - 使用者名稱 (預設: admin)
   - 電子郵件地址 (預設: admin@example.com)
   - 密碼 (至少 6 個字元)

5. 確認並完成初始化

## 預設配置選項

### 1. 本地開發環境
- 主機: localhost
- 連接埠: 27017
- 資料庫: web_db
- 無需認證

### 2. 本地核心服務
- 主機: localhost
- 連接埠: 55101
- 使用者名稱: web_ui
- 密碼: hod2iddfsgsrl
- 資料庫: web_db
- 認證資料庫: admin

### 3. 自訂設定
允許完全自訂所有連接參數，包括：
- 主機地址
- 連接埠
- 使用者名稱和密碼
- 資料庫名稱
- 認證資料庫

## 功能說明

- **使用者驗證**: 檢查使用者名稱和電子郵件是否已存在
- **密碼安全**: 使用 bcrypt 進行密碼雜湊
- **索引建立**: 自動建立必要的資料庫索引
- **錯誤處理**: 完整的錯誤處理和日誌記錄
- **連接測試**: 在操作前測試資料庫連接

## 注意事項

1. 確保 MongoDB 服務已啟動並可連接
2. 如果使用認證，請確保提供的帳戶具有適當權限
3. 工具會自動建立必要的資料庫索引
4. 每次執行只能建立一個管理員帳戶
5. 如果帳戶已存在，工具會報錯並退出

## 故障排除

### 連接失敗
- 檢查 MongoDB 服務是否啟動
- 確認主機地址和連接埠正確
- 驗證使用者名稱和密碼

### 權限錯誤
- 確保 MongoDB 使用者具有建立索引和插入文檔的權限
- 檢查認證資料庫設定是否正確

### 依賴問題
```bash
pip install --upgrade pymongo flask-bcrypt
```

## 範例輸出

```
============================================================
Sound Multi Analysis System
管理員帳戶初始化工具 (獨立版)
============================================================

此工具可以連接到任何 MongoDB 資料庫並建立管理員使用者
適用於開發、測試和生產環境的初始化作業

============================================================
MongoDB 資料庫連接設定
============================================================

請選擇資料庫配置:
  1. 本地開發環境 (預設)
  2. 本地核心服務
  3. 自訂設定

請選擇 (1-3): 2

============================================================
管理員帳戶設定
============================================================

管理員使用者名稱 [admin]: admin
管理員電子郵件 [admin@example.com]: admin@example.com
管理員密碼 (至少 6 個字元): 
確認密碼: 

============================================================
開始初始化...
============================================================

✓ 成功連接到 MongoDB: localhost:55101/web_db

正在建立資料庫索引...
✓ 資料庫索引建立成功

正在生成密碼雜湊...
正在建立管理員帳戶...
✓ 使用者建立成功: admin

============================================================
✓ 初始化完成！

管理員帳戶資訊:
  使用者名稱: admin
  電子郵件: admin@example.com
  角色: 管理員

資料庫資訊:
  主機: localhost:55101
  資料庫: web_db

您可以使用上述資訊登入管理介面
```